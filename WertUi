local WertUi = {}
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local Theme = {
    Accent = Color3.fromRGB(0, 170, 255),
    Background = Color3.fromRGB(28, 28, 28),
    Button = Color3.fromRGB(45, 45, 45),
    Text = Color3.fromRGB(255, 255, 255)
}

function WertUi:SetTheme(newTheme)
    for k, v in pairs(newTheme) do
        if Theme[k] then
            Theme[k] = v
        end
    end
    if self._instances then
        for _, obj in ipairs(self._instances) do
            if obj:IsA("Frame") or obj:IsA("TextButton") or obj:IsA("TextBox") then
                if obj:GetAttribute("ui_type") == "main" then
                    obj.BackgroundColor3 = Theme.Background
                elseif obj:GetAttribute("ui_type") == "button" or obj:GetAttribute("ui_type") == "input" then
                    obj.BackgroundColor3 = Theme.Button
                elseif obj:GetAttribute("ui_type") == "indicator" then
                    obj.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
                end
            elseif obj:IsA("TextLabel") then
                obj.TextColor3 = Theme.Text
            end
        end
    end
end

function WertUi:CreateWindow(config)
    local Window = {}
    self._instances = self._instances or {}
    local Title = config.Title or "WertUi"
    local CornerRadius = config.Corner or 10
    local Size = config.Size or UDim2.fromOffset(280, 300)
    local Scale = config.Scale or 1

    local charset = "QWERTYUIOPASDFGHJKLZXCVBNM1234567890"
    local function randomName(length)
        local name = ""
        for i = 1, length do
            local rand = math.random(1, #charset)
            name = name .. string.sub(charset, rand, rand)
        end
        return name
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = randomName(8)
    ScreenGui.Parent = CoreGui
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = Size
    MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    MainFrame.BackgroundColor3 = Theme.Background
    MainFrame.Active = true
    MainFrame.Draggable = true
    MainFrame.Parent = ScreenGui
    MainFrame:SetAttribute("ui_type", "main")

    local UIScale = Instance.new("UIScale")
    UIScale.Parent = MainFrame
    UIScale.Scale = Scale

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, CornerRadius)
    UICorner.Parent = MainFrame

    local ScrollingFrame = Instance.new("ScrollingFrame")
    ScrollingFrame.Parent = MainFrame
    ScrollingFrame.BackgroundTransparency = 1
    ScrollingFrame.Size = UDim2.new(1, 0, 1, 0)
    ScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    ScrollingFrame.ScrollBarThickness = 4
    ScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y

    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.Parent = ScrollingFrame
    UIListLayout.Padding = UDim.new(0, 6)
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    function Window:Section(cfg)
        local Section = Instance.new("TextLabel")
        Section.Parent = ScrollingFrame
        Section.Size = UDim2.new(1, -10, 0, 30)
        Section.BackgroundTransparency = 1
        Section.Text = cfg.Title or "Section"
        Section.Font = Enum.Font.GothamBold
        Section.TextSize = cfg.TextSize or 17
        Section.TextColor3 = Theme.Text
        Section.TextXAlignment = Enum.TextXAlignment[cfg.TextXAlignment or "Left"]
        table.insert(WertUi._instances, Section)
    end

    function Window:Button(cfg)
        local Button = Instance.new("TextButton")
        Button.Parent = ScrollingFrame
        Button.Size = UDim2.new(1, -10, 0, 35)
        Button.BackgroundColor3 = Theme.Button
        Button.Text = cfg.Title or "Button"
        Button.Font = Enum.Font.Gotham
        Button.TextSize = 15
        Button.TextColor3 = Theme.Text
        Button.AutoButtonColor = false
        Button:SetAttribute("ui_type", "button")

        local UICorner = Instance.new("UICorner", Button)
        UICorner.CornerRadius = UDim.new(0, 6)

        Button.MouseEnter:Connect(function()
            TweenService:Create(Button, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Accent}):Play()
        end)
        Button.MouseLeave:Connect(function()
            TweenService:Create(Button, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Button}):Play()
        end)
        Button.MouseButton1Click:Connect(function()
            if cfg.Callback then cfg.Callback() end
        end)
        table.insert(WertUi._instances, Button)
    end

    function Window:Toggle(cfg)
        local ToggleFrame = Instance.new("Frame")
        ToggleFrame.Parent = ScrollingFrame
        ToggleFrame.Size = UDim2.new(1, -10, 0, 35)
        ToggleFrame.BackgroundColor3 = Theme.Button
        ToggleFrame:SetAttribute("ui_type", "button")

        local UICorner = Instance.new("UICorner", ToggleFrame)
        UICorner.CornerRadius = UDim.new(0, 6)

        local Title = Instance.new("TextLabel")
        Title.Parent = ToggleFrame
        Title.Text = cfg.Title or "Toggle"
        Title.Size = UDim2.new(1, -40, 1, 0)
        Title.BackgroundTransparency = 1
        Title.TextColor3 = Theme.Text
        Title.Font = Enum.Font.Gotham
        Title.TextSize = 15
        Title.TextXAlignment = Enum.TextXAlignment.Left

        local Indicator = Instance.new("Frame")
        Indicator.Parent = ToggleFrame
        Indicator.Size = UDim2.new(0, 20, 0, 20)
        Indicator.Position = UDim2.new(1, -30, 0.5, -10)
        Indicator.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        Indicator:SetAttribute("ui_type", "indicator")

        local IndicatorCorner = Instance.new("UICorner", Indicator)
        IndicatorCorner.CornerRadius = UDim.new(0, 1)

        local enabled = false
        ToggleFrame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                enabled = not enabled
                TweenService:Create(Indicator, TweenInfo.new(0.15), {
                    BackgroundColor3 = enabled and Theme.Accent or Color3.fromRGB(60, 60, 60)
                }):Play()
                if cfg.Callback then cfg.Callback(enabled) end
            end
        end)
        table.insert(WertUi._instances, ToggleFrame)
    end

    function Window:Input(cfg)
        local InputBox = Instance.new("TextBox")
        InputBox.Parent = ScrollingFrame
        InputBox.Size = UDim2.new(1, -10, 0, 35)
        InputBox.PlaceholderText = cfg.Placeholder or "Enter text..."
        InputBox.Text = ""
        InputBox.BackgroundColor3 = Theme.Button
        InputBox.TextColor3 = Theme.Text
        InputBox.Font = Enum.Font.Gotham
        InputBox.TextSize = 15
        InputBox:SetAttribute("ui_type", "input")

        local UICorner = Instance.new("UICorner", InputBox)
        UICorner.CornerRadius = UDim.new(0, 6)

        InputBox.FocusLost:Connect(function()
            if cfg.Callback then cfg.Callback(InputBox.Text) end
        end)
        table.insert(WertUi._instances, InputBox)
    end

    function Window:Divider()
        local Line = Instance.new("Frame")
        Line.Parent = ScrollingFrame
        Line.Size = UDim2.new(1, -10, 0, 1)
        Line.BackgroundColor3 = Theme.Accent
    end

    function Window:EditToggle(cfg)
        local Title = cfg.Title or "Open"
        local Corner = cfg.Corner or 6

        local ToggleButton = Instance.new("TextButton")
        ToggleButton.Name = "EditToggle"
        ToggleButton.Text = Title
        ToggleButton.Parent = ScreenGui
        ToggleButton.Size = UDim2.new(0, 100, 0, 35)
        ToggleButton.Position = UDim2.new(0, 20, 0, 20)
        ToggleButton.BackgroundColor3 = Theme.Button
        ToggleButton.TextColor3 = Theme.Text
        ToggleButton.Font = Enum.Font.GothamBold
        ToggleButton.TextSize = 15
        ToggleButton.AutoButtonColor = false
        ToggleButton.Visible = true

        local UICorner = Instance.new("UICorner", ToggleButton)
        UICorner.CornerRadius = UDim.new(0, Corner)

        local UIStroke = Instance.new("UIStroke", ToggleButton)
        UIStroke.Thickness = 1.1
        UIStroke.Color = Theme.Accent

        local open = true

        local function hoverEffect(btn)
            btn.MouseEnter:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Accent}):Play()
            end)
            btn.MouseLeave:Connect(function()
                TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Button}):Play()
            end)
        end
        hoverEffect(ToggleButton)

        ToggleButton.MouseButton1Click:Connect(function()
            open = not open
            if open then
                MainFrame.Visible = true
                TweenService:Create(MainFrame, TweenInfo.new(0.3), {Size = Size, BackgroundTransparency = 0}):Play()
            else
                TweenService:Create(MainFrame, TweenInfo.new(0.3), {Size = UDim2.new(0, 0, 0, 0), BackgroundTransparency = 1}):Play()
                task.wait(0.3)
                MainFrame.Visible = false
            end
        end)
    end

    return Window
end

return WertUi
-- PopupUI Library
local PopupUI = {}
PopupUI.__index = PopupUI

local Players = game:GetService("Players")
local CollectionService = game:GetService("CollectionService")
local player = Players.LocalPlayer

local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
CollectionService:AddTag(screenGui, "main")

function PopupUI:Show(config)
    local frame = Instance.new("Frame")
    frame.Parent = screenGui
    frame.BorderSizePixel = 0
    frame.BackgroundColor3 = Color3.fromRGB(41, 41, 41)
    frame.AnchorPoint = Vector2.new(0.5, 0.5)
    frame.Position = UDim2.new(0.5, 0, 0.5, 0)

    local screenSize = workspace.CurrentCamera.ViewportSize
    local frameWidth = math.clamp(screenSize.X * 0.4, 200, 600)
    local frameHeight = math.clamp(screenSize.Y * 0.25, 100, 400)
    frame.Size = UDim2.new(0, frameWidth, 0, frameHeight)

    local frameCorner = Instance.new("UICorner")
    frameCorner.Parent = frame

    if config.Icon then
        local imageLabel = Instance.new("ImageLabel")
        imageLabel.Parent = frame
        imageLabel.BorderSizePixel = 0
        imageLabel.BackgroundTransparency = 1
        imageLabel.Image = config.Icon
        imageLabel.AnchorPoint = Vector2.new(0, 0)
        imageLabel.Position = UDim2.new(0.02, 0, 0.05, 0)
        imageLabel.Size = UDim2.new(0.4, 0, 0.6, 0)
        local imageCorner = Instance.new("UICorner")
        imageCorner.Parent = imageLabel
    end

    local title = Instance.new("TextLabel")
    title.Parent = frame
    title.TextWrapped = true
    title.BorderSizePixel = 0
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(228, 228, 228)
    title.AnchorPoint = Vector2.new(0, 0)
    title.Position = UDim2.new(0.45, 0, 0.1, 0)
    title.Size = UDim2.new(0.53, 0, 0.5, 0)
    title.Text = config.Title or "Popup"
    title.TextScaled = true

    local aspect = Instance.new("UIAspectRatioConstraint")
    aspect.Parent = frame
    aspect.AspectRatio = 2.20513
    aspect.AspectType = Enum.AspectType.ScaleWithParent

    if config.Button1 then
        local btn1 = Instance.new("TextButton")
        btn1.Parent = frame
        btn1.Text = config.Button1
        btn1.TextScaled = true
        btn1.TextWrapped = true
        btn1.BackgroundColor3 = Color3.fromRGB(36, 36, 36)
        btn1.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn1.AnchorPoint = Vector2.new(0.5, 0)
        btn1.Position = UDim2.new(0.35, 0, 0.7, 0)
        btn1.Size = UDim2.new(0.25, 0, 0.2, 0)
        local corner1 = Instance.new("UICorner")
        corner1.Parent = btn1

        if config.Button1Callback then
            btn1.MouseButton1Click:Connect(function()
                config.Button1Callback()
                frame:Destroy()
            end)
        else
            btn1.MouseButton1Click:Connect(function()
                frame:Destroy()
            end)
        end
    end

    if config.Button2 then
        local btn2 = Instance.new("TextButton")
        btn2.Parent = frame
        btn2.Text = config.Button2
        btn2.TextScaled = true
        btn2.TextWrapped = true
        btn2.BackgroundColor3 = Color3.fromRGB(36, 36, 36)
        btn2.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn2.AnchorPoint = Vector2.new(0.5, 0)
        btn2.Position = UDim2.new(0.65, 0, 0.7, 0)
        btn2.Size = UDim2.new(0.25, 0, 0.2, 0)
        local corner2 = Instance.new("UICorner")
        corner2.Parent = btn2

        if config.Button2Callback then
            btn2.MouseButton1Click:Connect(function()
                config.Button2Callback()
                frame:Destroy()
            end)
        else
            btn2.MouseButton1Click:Connect(function()
                frame:Destroy()
            end)
        end
    end
end

return setmetatable({}, PopupUI)

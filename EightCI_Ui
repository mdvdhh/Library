local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

local EightCI = {}

if CoreGui:FindFirstChild("EightCI_Window") then
    CoreGui:FindFirstChild("EightCI_Window"):Destroy()
end

function EightCI:CreateWindow(config)
    local Window = Instance.new("ScreenGui")
    Window.Name = "EightCI_Window"
    Window.Parent = CoreGui

    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.BackgroundColor3 = Color3.fromRGB(0,0,0)
    Main.BorderSizePixel = 0
    Main.Position = UDim2.new(0.5, -107, 0.5, -146)
    Main.Size = UDim2.new(0, 214, 0, 292)
    Main.Active = true
    Main.Draggable = true
    Main.Parent = Window

    local UICorner = Instance.new("UICorner")
    UICorner.Parent = Main

    local TitleBar = Instance.new("Frame")
    TitleBar.BackgroundTransparency = 1
    TitleBar.Size = UDim2.new(1,0,0,28)
    TitleBar.Position = UDim2.new(0,6,0,6)
    TitleBar.Parent = Main

    local Label = Instance.new("TextLabel")
    Label.BackgroundTransparency = 1
    Label.Size = UDim2.new(1,0,1,0)
    Label.Text = config.Title or "EightCI Ui"
    Label.TextColor3 = Color3.fromRGB(255,255,255)
    Label.TextScaled = true
    Label.Parent = TitleBar

    local Scroll = Instance.new("ScrollingFrame")
    Scroll.BackgroundTransparency = 1
    Scroll.BorderSizePixel = 0
    Scroll.ElasticBehavior = Enum.ElasticBehavior.Never
    Scroll.Position = UDim2.new(0,4,0,45)
    Scroll.Size = UDim2.new(0,206,0,241)
    Scroll.ScrollBarThickness = 3
    Scroll.Parent = Main

    local UIList = Instance.new("UIListLayout")
    UIList.Padding = UDim.new(0,6)
    UIList.Parent = Scroll

    local UIPadding = Instance.new("UIPadding")
    UIPadding.PaddingTop = UDim.new(0,5)
    UIPadding.PaddingLeft = UDim.new(0,8)
    UIPadding.PaddingRight = UDim.new(0,8)
    UIPadding.Parent = Scroll

    UIList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Scroll.CanvasSize = UDim2.new(0,0,0,UIList.AbsoluteContentSize.Y + 5)
    end)

    self.MainFrame = Main
    self.Scroll = Scroll
end

function EightCI:Button(config)
    local Button = Instance.new("TextButton")
    Button.BackgroundColor3 = Color3.fromRGB(60,60,60)
    Button.BorderSizePixel = 0
    Button.Size = UDim2.new(1,0,0,32)
    Button.Text = config.Title or "Button"
    Button.TextColor3 = Color3.fromRGB(255,255,255)
    Button.TextSize = 11
    Button.TextScaled = true
    Button.Parent = self.Scroll

    local Corner = Instance.new("UICorner")
    Corner.Parent = Button

    Button.MouseButton1Click:Connect(function()
        pcall(config.Callback)
    end)

    return Button
end

function EightCI:Toggle(config)
    local Toggle = Instance.new("TextButton")
    Toggle.BackgroundColor3 = Color3.fromRGB(60,60,60)
    Toggle.BorderSizePixel = 0
    Toggle.Size = UDim2.new(1,0,0,32)
    Toggle.Text = ""
    Toggle.Parent = self.Scroll

    local Corner = Instance.new("UICorner")
    Corner.Parent = Toggle

    local Label = Instance.new("TextLabel")
    Label.BackgroundTransparency = 1
    Label.Position = UDim2.new(0,9,0,3)
    Label.Size = UDim2.new(0.7,0,0.8,0)
    Label.Text = config.Title or "Toggle"
    Label.TextColor3 = Color3.fromRGB(255,255,255)
    Label.TextSize = 12
    Label.TextScaled = true
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Toggle

    local CheckBox = Instance.new("Frame")
    CheckBox.Position = UDim2.new(1,-28,0.5,-12)
    CheckBox.Size = UDim2.new(0,24,0,24)
    CheckBox.BackgroundColor3 = config.Default and Color3.fromRGB(0,170,255) or Color3.fromRGB(113,113,113)
    CheckBox.Parent = Toggle

    local CheckCorner = Instance.new("UICorner")
    CheckCorner.CornerRadius = UDim.new(1,0)
    CheckCorner.Parent = CheckBox

    local enabled = config.Default or false

    local function updateState()
        CheckBox.BackgroundColor3 = enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(111, 111, 111)
        pcall(config.Callback, enabled)
    end

    updateState()

    Toggle.MouseButton1Click:Connect(function()
        enabled = not enabled
        updateState()
    end)

    return Toggle
end

function EightCI:Slider(config)
    local SliderFrame = Instance.new("Frame")
    SliderFrame.BackgroundColor3 = Color3.fromRGB(60,60,60)
    SliderFrame.Size = UDim2.new(1,0,0,32)
    SliderFrame.Parent = self.Scroll

    local Corner = Instance.new("UICorner")
    Corner.Parent = SliderFrame

    local Label = Instance.new("TextLabel")
    Label.BackgroundTransparency = 1
    Label.Position = UDim2.new(0,5,0,0)
    Label.Size = UDim2.new(0.6,0,1,0)
    Label.Text = config.Title or "Slider"
    Label.TextColor3 = Color3.fromRGB(255,255,255)
    Label.TextSize = 12
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = SliderFrame

    local ValueLabel = Instance.new("TextLabel")
    ValueLabel.BackgroundTransparency = 1
    ValueLabel.Position = UDim2.new(0.7,0,0,0)
    ValueLabel.Size = UDim2.new(0.3, -5, 1, 0)
    ValueLabel.Text = tostring(config.Default or 0)
    ValueLabel.TextColor3 = Color3.fromRGB(255,255,255)
    ValueLabel.TextSize = 12
    ValueLabel.TextXAlignment = Enum.TextXAlignment.Right
    ValueLabel.Parent = SliderFrame

    local Track = Instance.new("Frame")
    Track.BackgroundColor3 = Color3.fromRGB(113,113,113)
    Track.Size = UDim2.new(1, -10, 0, 8)
    Track.Position = UDim2.new(0,5,0.5,-4)
    Track.Parent = SliderFrame

    local TrackCorner = Instance.new("UICorner")
    TrackCorner.CornerRadius = UDim.new(1,0)
    TrackCorner.Parent = Track

    local Handle = Instance.new("TextButton")
    Handle.BackgroundColor3 = Color3.fromRGB(0,170,255)
    Handle.Size = UDim2.new(0,12,0,12)
    Handle.Position = UDim2.new(0,0,0.5,-6)
    Handle.Parent = Track

    local HandleCorner = Instance.new("UICorner")
    HandleCorner.CornerRadius = UDim.new(1,0)
    HandleCorner.Parent = Handle

    local min = config.Min or 0
    local max = config.Max or 100
    local value = config.Default or min

    local dragging = false

    local function updateValue(x)
        local relative = math.clamp(x - Track.AbsolutePosition.X, 0, Track.AbsoluteSize.X)
        local percent = relative / Track.AbsoluteSize.X
        value = min + (max - min) * percent
        value = math.round(value * (config.Round or 1)) / (config.Round or 1)
        Handle.Position = UDim2.new(percent, -6, 0.5, -6)
        ValueLabel.Text = tostring(value)
        pcall(config.Callback, value)
    end

    local function inputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            updateValue(input.Position.X)
        end
    end

    local function inputChanged(input)
        if dragging then
            updateValue(input.Position.X)
        end
    end

    local function inputEnded(input)
        if dragging then
            dragging = false
        end
    end

    Track.InputBegan:Connect(inputBegan)
    Track.InputChanged:Connect(inputChanged)
    Track.InputEnded:Connect(inputEnded)
    Handle.InputBegan:Connect(inputBegan)
    Handle.InputChanged:Connect(inputChanged)
    Handle.InputEnded:Connect(inputEnded)

    return SliderFrame
end

return EightCI
